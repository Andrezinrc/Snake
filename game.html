<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="stylesheet" href="assets/styles/style.css">
  <link rel="stylesheet" href="assets/styles/mobile.css">
  <title>Jogo da cobrinha</title>
</head>
<body>

  <div class="container">
    <canvas id="gameCanvas"></canvas>

    <!--Menssagem perdeu-->
    <h2 id="voce-perdeu">Você perdeu!</h2>

    <!--Botoes mobile-->
    <div class="botoes" id="botoes">
      <div id="cima">&#8593;</div>
      <div id="baixo">&#8595;</div>
      <div id="esquerda">&#8592;</div>
      <div id="direita">&#8594;</div>
    </div>

    <!--Botao Jogar novamente-->
    <div id="jogar-novamente" onclick="Carregar()">
      <h1>Jogar Novamente</h1>
    </div>
    <!--Botao voltar-->
     <div class="botao-voltar" id="voltar" onclick="Voltar">
      <a href="index.html">Voltar</a>
    </div>
    <!--Botao pausar-->
    <div class="botao-pause" id="pausar"></div>
    <!--Botao continuar-->
    <div id="continuar" id="continuar">
      <h1>Continuar</h1>
    </div>
    <!--Botao sair-->
     <div class="sair" id="sair">
      <a href="https://www.google.com.br">Sair</a>
    </div>
    <!--Score-->
    <div id="pontuacao" class="pontuacao">Pontuação: 0</div>
    <!--tempo de jogo-->
    <p id="tempo" class="tempo">0</p>
    <!--Tempo do poder-->
    <p id="tempo-poder" class="tempo-poder"></p>
    <!--Animacao do poder-->
    <div class="pisca-pisca"></div>
  </div>
  
  <!--explicando o jogo-->
  <div class="sobre" id="sobre">
    <div class="fechar-sobre" id="fechar-sobre">
      <img src="assets/img/fechar.png" loading="lazy">
    </div>
    <h3>
       Neste jogo da Cobrinha, colete o quadrado vermelho para ganhar pontos e aumentar seu recorde. O quadrado Roxo é um poder especial que te deixa imune de colisão por 7 segundos. Desvie de você mesmo e tente bater seu maior recorde.
    </h3>
  </div>
  
  <script type="module" src="src/game.js"></script>
  <script type="module" src="src/home.js"></script>
  <script src="src/loader.js"></script>
  <script src="src/buttonEvents.js"></script>
  <script type="module" src="src/controles.js"></script>
  <script>
      let lastTouch = 0;
    
      // Impede o duplo clique/touch rápido em mobile de causar zoom
      document.querySelectorAll('#cima, #baixo, #esquerda, #direita, html, body').forEach(el => {
        el.addEventListener('touchstart', (e) => {
          const now = new Date().getTime();
          if (now - lastTouch <= 300) {
            e.preventDefault();
          }
          lastTouch = now;
        });
      });
    
      // Seletores principais
      const sobre = document.getElementById("sobre");
      const fecharSobre = document.getElementById("fechar-sobre");
    
      // Aplicar cor salva
      document.addEventListener("DOMContentLoaded", function () {
        const corDeFundo = localStorage.getItem("backgroundColor");
        if (corDeFundo) {
          document.body.style.backgroundColor = corDeFundo;
        }
      });
    
      // Ao clicar no botão fechar do banner
      fecharSobre.addEventListener("click", function () {
        const elem = document.documentElement;
    
        // Tenta fullscreen com promessa
        if (elem.requestFullscreen) {
          elem.requestFullscreen().then(() => {
            iniciarJogo();
          }).catch((err) => {
            console.warn("Erro ao tentar fullscreen:", err);
            iniciarJogo();
          });
        } else {
          iniciarJogo();
        }
      });
    
      //esconde banner e começa a lógica
      function iniciarJogo() {
        sobre.style.display = "none";
        movimenta = setInterval(meuGame, tempoVelocidade);
      }
    
      // Ajusta o viewport para evitar zoom indesejado em telas pequenas
      (function () {
        const largura = window.innerWidth;
        const meta = document.querySelector('meta[name=viewport]');
        if (meta) {
          meta.parentNode.removeChild(meta);
        }
    
        const novaMeta = document.createElement('meta');
        novaMeta.name = 'viewport';
    
        // Se for mobile muito pequeno, força uma largura mínima
        if (largura <= 380) {
          novaMeta.content = 'width=420, initial-scale=1.0, maximum-scale=1.0, user-scalable=no';
        } else {
          novaMeta.content = 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no';
        }
    
        document.head.appendChild(novaMeta);
      })();
    </script>
  </body>
</html>
